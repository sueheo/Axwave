name: Automated Email Sender ğŸ“§

# 1. ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´ ì„¤ì •
on:
  # ë§¤ì¼ UTC ê¸°ì¤€ 00:00 (í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ)ì— ì‹¤í–‰
  schedule:
    # cron í‘œí˜„ì‹: ë¶„ ì‹œ ì¼ ì›” ìš”ì¼
    # 0 0 * * *ëŠ” ë§¤ì¼ 00:00 UTCì— ì‹¤í–‰ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
    - cron: '0 0 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ì„ ìœ„í•œ ì›Œí¬í”Œë¡œìš° ë””ìŠ¤íŒ¨ì¹˜ ë²„íŠ¼ ì¶”ê°€
  workflow_dispatch:

  # 3. 'push' ì´ë²¤íŠ¸ì— ë¸Œëœì¹˜ ì„¤ì • ì¶”ê°€ (ë¸Œëœì¹˜ ë³€ê²½ì˜ í•µì‹¬)
  push:
    branches:
      # ğŸ‘‡ ì‹¤í–‰ì„ ì›í•˜ëŠ” ë¸Œëœì¹˜ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
      -ax_wave_automail

# 2. ì‹¤í–‰ë  ì‘ì—… ì •ì˜
jobs:
  send_report:
    # ì‹¤í–‰ í™˜ê²½ (ìµœì‹  Ubuntu ë¦¬ëˆ…ìŠ¤ í™˜ê²½ ì‚¬ìš©)
    runs-on: ubuntu-latest

    permissions:
      contents: write # ì €ì¥ì†Œ ë‚´ìš©(ì»¤ë°‹)ì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œ ë¶€ì—¬
      
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    env:
      # GitHub Secretsì— ì €ì¥ëœ ì•± ë¹„ë°€ë²ˆí˜¸ë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ë¡œë“œ
      # ìŠ¤í¬ë¦½íŠ¸(send_email.py)ì—ì„œ os.environ.get('EMAIL_PASSWORD')ë¡œ ì ‘ê·¼í•©ë‹ˆë‹¤.
      EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      
    # ì‘ì—… ì‹¤í–‰ ë‹¨ê³„
    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout Code
        uses: actions/checkout@v4
        
      # 2. Python í™˜ê²½ ì„¤ì •
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Python 3 ë²„ì „ ì‚¬ìš©
      
      # 3. í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (SMTP, JSON íŒŒì‹±ì€ ê¸°ë³¸ í¬í•¨)
      # ì´ë©”ì¼ ì²˜ë¦¬ì— í•„ìš”í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€í•©ë‹ˆë‹¤. (ì˜ˆ: pip install requests)
      - name: Install dependencies
        run: pip install requests # timeì€ í‘œì¤€ì´ì§€ë§Œ, requestsëŠ” í•„ìˆ˜ ì„¤ì¹˜!
      
      # 4. ì´ë©”ì¼ ë°œì†¡ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      # 'python send_email.py' ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
      - name: Execute Email Sender Script
        run: python send_email.py

      # 5. ì‹¤í–‰ ê²°ê³¼ íŒŒì¼ (last_run.txt) ì €ì¥ (ì„ íƒ ì‚¬í•­)
      # ë‹¤ìŒ ì‹¤í–‰ ì‹œ ìŠ¤í¬ë¦½íŠ¸ê°€ 'last_run.txt'ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì €ì¥ì†Œì— ë‹¤ì‹œ ì»¤ë°‹í•©ë‹ˆë‹¤.
      - name: Commit Last Run Time
        run: |
          # last_run.txt íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if git status --porcelain | grep "last_run.txt"; then
            git config user.name github-actions
            git config user.email github-actions@github.com
            git add last_run.txt
            git commit -m "Automated: Update last_run.txt after successful email dispatch"
            git push
          else
            echo "last_run.txt unchanged. Skipping commit."
          fi
        # secrets.GITHUB_TOKENì€ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” í† í°ìœ¼ë¡œ, ì»¤ë°‹ ê¶Œí•œì´ ìˆìŠµë‹ˆë‹¤.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
